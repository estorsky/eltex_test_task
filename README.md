# Менеджер сервисов

## mysystemd

Демон для запуска других демонов и управления ими в процессе работы.


### Функционал:

    * Сервис конфигурируется с помощью файла формата json.
    * При старте сервиса запускаются сервисы из списка.
    * Сервис отслеживает состояние подконтрольных ему демонов посредством zmq-сокетов. 
    * Логирование осуществляется с использованием библиотеки zlog.


### Конфигурация
Конфиг файл должен находиться в директории `deamons` и называться `config.json`.  
Пример конфигурационного файла:

    {
        "deamons": [
            {
                "name": "exampled",
                "num starts": 5,
                "args": [
                    "-b -c",
                    "-b -c",
                    "-b"
                ]
            },
            {
                "name": "exampled_second",
                "num starts": 2,
                "args": [
                    ""
                ]
            },
            {
                "name": "exampled_third",
                "num starts": 0,
                "args": [
                    "-l"
                ]
            }
        ]
    }

В объекте `deamons` описаны несколько подконтрольных сервисов.
В поле `name` необходимо указать имя запускаемого демона.
В поле `num starts` количество запусков данного демона.
В поле `args` соответственно параметры.

Сами демоны должны находиться в директории `deamons`.


### Синхронизация 

После запуска подконтрольный демон посылает сообщение с типом `init`, чтобы главный демон 
соотнес(проинициализировал) данный демон в список демонов.
Далее все сообщения, посылаемые подконтрольным демоном посылаются с типом `running`.
В случае если подконтрольный демон перестает посылать сообщения, главный демон посылает ему 
сигнал `SIGKILL` и перезапускает.


### Логирывание

Логирование ведется в файл `mysystemd.log`.


## mysystemd_shared_lib

Для взаимодействия с менеджером сервисов реализована динамическая библиотека `libmysystemd_shared.so`, 
которую необходимо прилинковать и подключить заголовочный файл `mysystemd_shared_lib.h`.

Чтобы подконтрольный демон имел возможность общения с менеджером сервисов необходимо вызвать 
функцию `mysystemd_sync(argv)`, в параметры которой необходимо передать аргументы функции `main`.


### Сборка

Для сборки проекта необходимо выполнить команду `make`.

### Используемые библиотеки:

<https://github.com/DaveGamble/cJSON>  
<https://github.com/zeromq/czmq>  
<https://github.com/HardySimpson/zlog>  

